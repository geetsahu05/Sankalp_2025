<%- include('../partials/header', { currentPage: 'events' }) %>

<!-- Header -->
<div class="mb-8">
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">Edit Event</h1>
            <p class="text-gray-600 mt-2">Update event details and information</p>
        </div>
        <a href="/admin/events" class="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors duration-200 font-medium flex items-center">
            <i class="fas fa-arrow-left mr-2"></i>
            Back to Events
        </a>
    </div>
</div>

<div class="max-w-4xl mx-auto">
    <div class="bg-white rounded-xl shadow-sm border border-gray-100">
        <div class="p-6 border-b border-gray-100">
            <h2 class="text-xl font-semibold text-gray-900 flex items-center">
                <i class="fas fa-edit text-blue-500 mr-2"></i>
                Edit Event Details
            </h2>
        </div>
        <div class="p-6">
            <form method="POST">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Left Column -->
                    <div class="space-y-4">
                        <div>
                            <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Event Name</label>
                            <input type="text" id="name" name="name" value="<%= event.name %>" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>

                        <div>
                            <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                            <textarea id="description" name="description" rows="4" required
                                      class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"><%= event.description %></textarea>
                        </div>

                        <div>
                            <label for="club" class="block text-sm font-medium text-gray-700 mb-1">Organizing Club</label>
                            <select id="club" name="club" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <% clubs.forEach(club => { %>
                                    <option value="<%= club._id %>" 
                                            <%= club._id.toString() === event.club._id.toString() ? 'selected' : '' %>>
                                        <%= club.name %>
                                    </option>
                                <% }) %>
                            </select>
                        </div>

                        <div>
                            <label for="type" class="block text-sm font-medium text-gray-700 mb-1">Type</label>
                            <select id="type" name="type" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="event" <%= event.type === 'event' ? 'selected' : '' %>>Event</option>
                                <option value="game" <%= event.type === 'game' ? 'selected' : '' %>>Game</option>
                            </select>
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div class="space-y-4">
                        <div>
                            <label for="venue" class="block text-sm font-medium text-gray-700 mb-1">Venue</label>
                            <input type="text" id="venue" name="venue" value="<%= event.venue %>" required
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="date" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                                <input type="date" id="date" name="date" value="<%= event.date.toISOString().split('T')[0] %>" required
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                            <div>
                                <label for="time" class="block text-sm font-medium text-gray-700 mb-1">Time</label>
                                <input type="time" id="time" name="time" value="<%= event.time %>" required
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            </div>
                        </div>

                        <div>
                            <label for="registration_link" class="block text-sm font-medium text-gray-700 mb-1">Registration Link (Optional)</label>
                            <input type="url" id="registration_link" name="registration_link" value="<%= event.registration_link %>" 
                                   placeholder="https://example.com"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>

                        <div>
                            <label for="poster" class="block text-sm font-medium text-gray-700 mb-1">Poster Image</label>
                            <input type="file" id="poster" name="poster" accept="image/*"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <p class="text-xs text-gray-500 mt-1">Leave empty to keep current poster. Max file size: 5MB</p>
                            
                            <% if (event.poster && event.poster.data) { %>
                                <div class="mt-3 p-3 bg-gray-50 rounded-lg">
                                    <p class="text-sm font-medium text-gray-700 mb-2">Current Poster:</p>
                                    <div class="flex items-center space-x-4">
                                        <img src="/admin/image/event/<%= event._id %>" alt="Current poster" 
                                             class="w-20 h-20 object-cover rounded-lg cursor-pointer hover:opacity-80 event-preview">
                                        <div class="text-sm text-gray-600">
                                            <p>Click to view larger</p>
                                            <p class="text-xs text-gray-500">Upload new image to replace</p>
                                        </div>
                                    </div>
                                </div>
                            <% } else { %>
                                <div class="mt-3 p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                                    <p class="text-sm text-yellow-700 flex items-center">
                                        <i class="fas fa-exclamation-triangle mr-2"></i>
                                        No poster image currently set
                                    </p>
                                </div>
                            <% } %>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex justify-end space-x-3 pt-6 mt-6 border-t border-gray-200">
                    <a href="/admin/events" 
                       class="bg-gray-100 text-gray-700 px-6 py-2 rounded-lg hover:bg-gray-200 transition-colors duration-200 font-medium flex items-center">
                        <i class="fas fa-times mr-2"></i>
                        Cancel
                    </a>
                    <button type="submit" 
                            class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors duration-200 font-medium flex items-center">
                        <i class="fas fa-save mr-2"></i>
                        Update Event
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal for larger image view -->
<div id="imageModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-xl max-w-2xl w-full mx-4">
        <div class="p-4 border-b border-gray-200 flex justify-between items-center">
            <h3 class="text-lg font-semibold">Current Poster</h3>
            <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="p-4">
            <img id="modalImage" src="" alt="" class="w-full h-auto rounded-lg">
        </div>
    </div>
</div>

<script>
// Image modal functionality
function openModal(imageSrc) {
    document.getElementById('modalImage').src = imageSrc;
    document.getElementById('imageModal').classList.remove('hidden');
}

function closeModal() {
    document.getElementById('imageModal').classList.add('hidden');
}

document.addEventListener('DOMContentLoaded', function() {
    // Preview image click
    const previewImage = document.querySelector('.event-preview');
    if (previewImage) {
        previewImage.addEventListener('click', function() {
            openModal(this.src);
        });
    }
    
    // Close modal when clicking outside
    document.getElementById('imageModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeModal();
        }
    });
    
    // Date validation - prevent past dates
    const dateInput = document.getElementById('date');
    const today = new Date().toISOString().split('T')[0];
    dateInput.min = today;
    
    // File validation
    const fileInput = document.getElementById('poster');
    fileInput.addEventListener('change', function() {
        const file = this.files[0];
        if (file) {
            const maxSize = 5 * 1024 * 1024; // 5MB
            if (file.size > maxSize) {
                alert('File size must be less than 5MB');
                this.value = '';
                return;
            }
            
            const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
            if (!allowedTypes.includes(file.type)) {
                alert('Please select a valid image file (JPG, PNG, GIF, WEBP)');
                this.value = '';
            }
            
            // Preview new image
            const reader = new FileReader();
            reader.onload = function(e) {
                const preview = document.querySelector('.event-preview');
                if (preview) {
                    preview.src = e.target.result;
                }
            };
            reader.readAsDataURL(file);
        }
    });

    // Add interactive effects to form inputs
    const formInputs = document.querySelectorAll('input, select, textarea');
    formInputs.forEach(input => {
        input.addEventListener('focus', function() {
            this.classList.add('ring-2', 'ring-blue-200');
        });
        input.addEventListener('blur', function() {
            this.classList.remove('ring-2', 'ring-blue-200');
        });
    });
    
    // Form validation
    const form = document.querySelector('form');
    form.addEventListener('submit', function(e) {
        const name = document.getElementById('name').value.trim();
        const description = document.getElementById('description').value.trim();
        const venue = document.getElementById('venue').value.trim();
        
        if (!name || !description || !venue) {
            e.preventDefault();
            alert('Please fill in all required fields');
            return false;
        }
    });
});
</script>

<%- include('../partials/footer') %>